{"version":3,"file":"index.js","names":["sinon","require","mongoose","mockProxy","mockOrFailOp","mockExecQuery","mockInsertManyOp","mockExecAggregate","mockModelInstances","test","version","Promise","stub","resolves","returns","catch","model","bind","on","once","then","resolve","Query","prototype","callsFake","Aggregate","Model","instances","forEach","methodName","module","exports"],"sources":["../src/index.js"],"sourcesContent":["const sinon = require('sinon');\nconst mongoose = require('mongoose');\n\nconst mockProxy = require('./mock-proxy');\nconst mockOrFailOp = require('./mocks/orFail-op');\nconst mockExecQuery = require('./mocks/query-exec');\nconst mockInsertManyOp = require('./mocks/insertMany-op');\nconst mockExecAggregate = require('./mocks/aggregate-exec');\nconst mockModelInstances = require('./mocks/model-instances');\n\nif (!/^5/.test(mongoose.version)) {\n  mongoose.Promise = Promise;\n}\n\nsinon.stub(mongoose, 'connect').resolves();\n\nsinon.stub(mongoose, 'createConnection').returns({\n  catch() {\n    /* no op */\n  },\n  model: mongoose.model.bind(mongoose),\n  on: sinon.stub(),\n  once: sinon.stub(),\n  then(resolve) {\n    return Promise.resolve(resolve(this));\n  },\n});\n\nsinon.stub(mongoose.Query.prototype, 'exec').callsFake(mockExecQuery);\n\nsinon.stub(mongoose.Query.prototype, 'orFail').callsFake(mockOrFailOp);\n\nsinon.stub(mongoose.Aggregate.prototype, 'exec').callsFake(mockExecAggregate);\n\nsinon.stub(mongoose.Model, 'insertMany').callsFake(mockInsertManyOp);\n\nconst instances = ['save', '$save', 'updateOne', 'deleteOne'];\n\ninstances.forEach((methodName) => {\n  sinon\n    .stub(mongoose.Model.prototype, methodName)\n    .callsFake(mockModelInstances(methodName));\n});\n\nmodule.exports = mockProxy;\n"],"mappings":";;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAME,SAAS,GAAGF,OAAO,CAAC,cAAc,CAAC;AACzC,MAAMG,YAAY,GAAGH,OAAO,CAAC,mBAAmB,CAAC;AACjD,MAAMI,aAAa,GAAGJ,OAAO,CAAC,oBAAoB,CAAC;AACnD,MAAMK,gBAAgB,GAAGL,OAAO,CAAC,uBAAuB,CAAC;AACzD,MAAMM,iBAAiB,GAAGN,OAAO,CAAC,wBAAwB,CAAC;AAC3D,MAAMO,kBAAkB,GAAGP,OAAO,CAAC,yBAAyB,CAAC;AAE7D,IAAI,CAAC,IAAI,CAACQ,IAAI,CAACP,QAAQ,CAACQ,OAAO,CAAC,EAAE;EAChCR,QAAQ,CAACS,OAAO,GAAGA,OAAO;AAC5B;AAEAX,KAAK,CAACY,IAAI,CAACV,QAAQ,EAAE,SAAS,CAAC,CAACW,QAAQ,CAAC,CAAC;AAE1Cb,KAAK,CAACY,IAAI,CAACV,QAAQ,EAAE,kBAAkB,CAAC,CAACY,OAAO,CAAC;EAC/CC,KAAKA,CAAA,EAAG;IACN;EAAA,CACD;EACDC,KAAK,EAAEd,QAAQ,CAACc,KAAK,CAACC,IAAI,CAACf,QAAQ,CAAC;EACpCgB,EAAE,EAAElB,KAAK,CAACY,IAAI,CAAC,CAAC;EAChBO,IAAI,EAAEnB,KAAK,CAACY,IAAI,CAAC,CAAC;EAClBQ,IAAIA,CAACC,OAAO,EAAE;IACZ,OAAOV,OAAO,CAACU,OAAO,CAACA,OAAO,CAAC,IAAI,CAAC,CAAC;EACvC;AACF,CAAC,CAAC;AAEFrB,KAAK,CAACY,IAAI,CAACV,QAAQ,CAACoB,KAAK,CAACC,SAAS,EAAE,MAAM,CAAC,CAACC,SAAS,CAACnB,aAAa,CAAC;AAErEL,KAAK,CAACY,IAAI,CAACV,QAAQ,CAACoB,KAAK,CAACC,SAAS,EAAE,QAAQ,CAAC,CAACC,SAAS,CAACpB,YAAY,CAAC;AAEtEJ,KAAK,CAACY,IAAI,CAACV,QAAQ,CAACuB,SAAS,CAACF,SAAS,EAAE,MAAM,CAAC,CAACC,SAAS,CAACjB,iBAAiB,CAAC;AAE7EP,KAAK,CAACY,IAAI,CAACV,QAAQ,CAACwB,KAAK,EAAE,YAAY,CAAC,CAACF,SAAS,CAAClB,gBAAgB,CAAC;AAEpE,MAAMqB,SAAS,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,WAAW,CAAC;AAE7DA,SAAS,CAACC,OAAO,CAAEC,UAAU,IAAK;EAChC7B,KAAK,CACFY,IAAI,CAACV,QAAQ,CAACwB,KAAK,CAACH,SAAS,EAAEM,UAAU,CAAC,CAC1CL,SAAS,CAAChB,kBAAkB,CAACqB,UAAU,CAAC,CAAC;AAC9C,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAG5B,SAAS"}